<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Keuangan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .table-container {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 2px solid #FFD700;
        }
        table {
            border-collapse: separate;
        }
        th, td {
            border-right: 1px solid #e5e7eb;
        }
        th:last-child, td:last-child {
            border-right: none;
        }
        .notification {
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
            transform: translate(-50%, -100px); /* Awalnya di atas layar */
            opacity: 0;
            pointer-events: none;
        }
        .notification.show {
            transform: translate(-50%, 0); /* Posisi akhir di tengah atas */
            opacity: 1;
            pointer-events: auto;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen pt-2 pb-10 w-full relative">

    <!-- Notifikasi -->
    <div id="notification" class="notification fixed top-4 left-1/2 -translate-x-1/2 bg-green-500 text-white text-center py-2 px-4 rounded-lg shadow-lg z-50">
        Transaksi berhasil disimpan!
    </div>

    <div class="w-full max-w-4xl mx-auto bg-white p-4 md:p-8 lg:p-10 shadow-2xl rounded-3xl">

        <!-- Konten Utama (Formulir & Saldo/Tombol) - Toggling view -->
        <div id="main-view">
            <form id="transaction-form" class="space-y-4 p-6 bg-gray-50 rounded-2xl">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label for="date" class="block text-sm font-medium text-gray-700">Tanggal</label>
                        <input type="date" id="date" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="description" class="block text-sm font-medium text-gray-700">Keterangan</label>
                        <input type="text" id="description" required placeholder="" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="income" class="block text-sm font-medium text-gray-700">Masuk (Rp)</label>
                        <input type="tel" id="income" placeholder="" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="expense" class="block text-sm font-medium text-gray-700">Keluar (Rp)</label>
                        <input type="tel" id="expense" placeholder="" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    </div>
                </div>
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-300 ease-in-out">
                    Simpan
                </button>
            </form>
            
            <div class="flex flex-col md:flex-row items-center justify-between gap-4 mt-6 p-4 rounded-xl bg-gray-50">
                <div class="flex-1 text-center md:text-left">
                    <div class="text-sm font-semibold text-gray-800">
                        Saldo Saat Ini:
                    </div>
                    <div id="current-balance" class="text-xl font-bold text-green-600">Rp 0</div>
                </div>
                <div class="flex flex-col md:flex-row gap-2 w-full md:w-auto">
                    <button id="report-button" class="w-full md:w-auto bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-300 ease-in-out">
                        Tampilkan Laporan
                    </button>
                    <button id="edit-button" class="w-full md:w-auto bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-300 ease-in-out">
                        Edit
                    </button>
                </div>
            </div>
        </div>

        <!-- Bagian Laporan -->
        <div id="report-view" class="pt-0.5 hidden">
            <div class="flex flex-col items-center justify-center mb-4">
                <button id="back-button-report" class="bg-black hover:bg-gray-900 text-white font-bold py-2 px-4 rounded-lg border-2 border-amber-400 hover:border-amber-500 transition duration-300 ease-in-out">
                    BIOP PJ Batur
                </button>
                <div class="text-sm font-semibold text-gray-800 mt-2">
                    Saldo: <span id="report-balance" class="font-bold text-green-600">Rp 0</span>
                </div>
            </div>
            
            <div class="overflow-x-auto w-full table-container">
                <table class="w-full bg-white">
                    <thead>
                        <tr class="bg-gray-200 text-gray-600 uppercase text-xs sm:text-sm leading-normal">
                            <th class="py-3 px-2 sm:px-4 text-left">Tgl</th>
                            <th class="py-3 px-2 sm:px-4 text-left">Keterangan</th>
                            <th class="py-3 px-2 sm:px-4 text-right text-green-600">Masuk</th>
                            <th class="py-3 px-2 sm:px-4 text-right text-red-600">Keluar</th>
                        </tr>
                    </thead>
                    <tbody id="report-table-body" class="text-gray-600 text-xs sm:text-sm font-light">
                        <!-- Konten tabel akan diisi oleh JavaScript -->
                    </tbody>
                </table>
            </div>

            <div id="empty-message-report" class="text-center text-gray-500 text-lg py-10 hidden">
                Belum ada transaksi. Silakan tambahkan satu!
            </div>
        </div>

        <!-- Bagian Edit -->
        <div id="edit-view" class="pt-0.5 hidden">
            <div class="flex flex-col items-center justify-center mb-4">
                <button id="back-button-edit" class="bg-black hover:bg-gray-900 text-white font-bold py-2 px-4 rounded-lg border-2 border-amber-400 hover:border-amber-500 transition duration-300 ease-in-out">
                    BIOP PJ Batur
                </button>
            </div>
            <div class="overflow-x-auto w-full table-container">
                <table class="w-full bg-white">
                    <thead>
                        <tr class="bg-gray-200 text-gray-600 uppercase text-xs sm:text-sm leading-normal">
                            <th class="py-3 px-2 sm:px-4 text-left">Tgl</th>
                            <th class="py-3 px-2 sm:px-4 text-left">Keterangan</th>
                            <th class="py-3 px-2 sm:px-4 text-right text-green-600">Masuk</th>
                            <th class="py-3 px-2 sm:px-4 text-right text-red-600">Keluar</th>
                            <th class="py-3 px-2 sm:px-4 text-center">Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="edit-table-body" class="text-gray-600 text-xs sm:text-sm font-light">
                        <!-- Konten tabel akan diisi oleh JavaScript -->
                    </tbody>
                </table>
            </div>
            <div id="empty-message-edit" class="text-center text-gray-500 text-lg py-10 hidden">
                Belum ada transaksi. Silakan tambahkan satu!
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const mainView = document.getElementById('main-view');
            const reportView = document.getElementById('report-view');
            const editView = document.getElementById('edit-view');
            const reportButton = document.getElementById('report-button');
            const editButton = document.getElementById('edit-button');
            const backButtonReport = document.getElementById('back-button-report');
            const backButtonEdit = document.getElementById('back-button-edit');
            const currentBalanceEl = document.getElementById('current-balance');
            const reportBalanceEl = document.getElementById('report-balance');
            const reportTableBody = document.getElementById('report-table-body');
            const editTableBody = document.getElementById('edit-table-body');
            const emptyMessageReport = document.getElementById('empty-message-report');
            const emptyMessageEdit = document.getElementById('empty-message-edit');
            const transactionForm = document.getElementById('transaction-form');
            const submitButton = transactionForm.querySelector('button[type="submit"]');
            const notificationEl = document.getElementById('notification');

            const dateInput = document.getElementById('date');
            const descriptionInput = document.getElementById('description');
            const incomeInput = document.getElementById('income');
            const expenseInput = document.getElementById('expense');

            let transactions = [];
            let editingIndex = -1;
            
            // Ambil data dari localStorage saat aplikasi dimuat
            function loadTransactions() {
                const storedTransactions = localStorage.getItem('financialTransactions');
                if (storedTransactions) {
                    transactions = JSON.parse(storedTransactions);
                }
                updateBalance();
            }

            // Simpan data ke localStorage
            function saveTransactions() {
                localStorage.setItem('financialTransactions', JSON.stringify(transactions));
            }

            // Memperbarui saldo saat ini
            function updateBalance() {
                const totalBalance = transactions.reduce((acc, t) => acc + (t.income - t.expense), 0);
                const formattedBalance = `Rp ${totalBalance.toLocaleString('id-ID')}`;
                
                currentBalanceEl.textContent = formattedBalance;
                reportBalanceEl.textContent = formattedBalance;
                
                currentBalanceEl.classList.remove('text-green-600', 'text-red-600');
                reportBalanceEl.classList.remove('text-green-600', 'text-red-600');
                if (totalBalance >= 0) {
                    currentBalanceEl.classList.add('text-green-600');
                    reportBalanceEl.classList.add('text-green-600');
                } else {
                    currentBalanceEl.classList.add('text-red-600');
                    reportBalanceEl.classList.add('text-red-600');
                }
            }

            // Fungsi untuk menampilkan notifikasi
            function showNotification(message) {
                notificationEl.textContent = message;
                notificationEl.classList.add('show');
                setTimeout(() => {
                    notificationEl.classList.remove('show');
                }, 3000);
            }

            // Fungsi untuk memformat angka dengan pemisah ribuan
            function formatNumber(input) {
                let value = input.value.replace(/\D/g, '');
                if (value) {
                    input.value = new Intl.NumberFormat('id-ID').format(value);
                }
            }

            // Tambahkan event listener untuk memformat angka secara real-time
            incomeInput.addEventListener('keyup', (e) => formatNumber(e.target));
            expenseInput.addEventListener('keyup', (e) => formatNumber(e.target));

            // Pindah fokus setelah memilih tanggal
            dateInput.addEventListener('change', () => {
                descriptionInput.focus();
            });

            // Menambah atau mengedit transaksi
            transactionForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const date = document.getElementById('date').value;
                const description = document.getElementById('description').value;
                const income = parseFloat(incomeInput.value.replace(/\./g, '')) || 0;
                const expense = parseFloat(expenseInput.value.replace(/\./g, '')) || 0;

                if (!date || !description || (income === 0 && expense === 0)) {
                    return;
                }

                if (editingIndex > -1) {
                    transactions[editingIndex] = { date, description, income, expense };
                    editingIndex = -1;
                    submitButton.textContent = 'Simpan';
                } else {
                    const newTransaction = { date, description, income, expense };
                    transactions.push(newTransaction);
                }

                saveTransactions();
                updateBalance();
                
                // Tampilkan notifikasi
                showNotification('Transaksi berhasil disimpan!');
                
                // Reset form
                transactionForm.reset();
                incomeInput.value = '';
                expenseInput.value = '';
            });

            // Menampilkan laporan
            reportButton.addEventListener('click', () => {
                reportTableBody.innerHTML = '';
                
                if (transactions.length === 0) {
                    emptyMessageReport.classList.remove('hidden');
                } else {
                    emptyMessageReport.classList.add('hidden');
                    
                    transactions.forEach(transaction => {
                        const dateObj = new Date(transaction.date);
                        const day = dateObj.getDate();
                        
                        const row = document.createElement('tr');
                        row.classList.add('border-b', 'border-gray-200', 'hover:bg-gray-100');
                        
                        row.innerHTML = `
                            <td class="py-3 px-2 sm:px-4 text-left whitespace-nowrap">${day}</td>
                            <td class="py-3 px-2 sm:px-4 text-left">${transaction.description}</td>
                            <td class="py-3 px-2 sm:px-4 text-right font-medium text-green-600">${transaction.income.toLocaleString('id-ID')}</td>
                            <td class="py-3 px-2 sm:px-4 text-right font-medium text-red-600">${transaction.expense.toLocaleString('id-ID')}</td>
                        `;
                        reportTableBody.appendChild(row);
                    });
                }
                
                // Toggle view
                mainView.classList.add('hidden');
                reportView.classList.remove('hidden');
            });

            // Menampilkan tampilan edit
            editButton.addEventListener('click', () => {
                editTableBody.innerHTML = '';
                
                if (transactions.length === 0) {
                    emptyMessageEdit.classList.remove('hidden');
                } else {
                    emptyMessageEdit.classList.add('hidden');
                    
                    transactions.forEach((transaction, index) => {
                        const dateObj = new Date(transaction.date);
                        const day = dateObj.getDate();
                        
                        const row = document.createElement('tr');
                        row.classList.add('border-b', 'border-gray-200', 'hover:bg-gray-100');
                        
                        row.innerHTML = `
                            <td class="py-3 px-2 sm:px-4 text-left whitespace-nowrap">${day}</td>
                            <td class="py-3 px-2 sm:px-4 text-left">${transaction.description}</td>
                            <td class="py-3 px-2 sm:px-4 text-right font-medium text-green-600">${transaction.income.toLocaleString('id-ID')}</td>
                            <td class="py-3 px-2 sm:px-4 text-right font-medium text-red-600">${transaction.expense.toLocaleString('id-ID')}</td>
                            <td class="py-3 px-2 sm:px-4 text-center">
                                <div class="flex flex-col sm:flex-row gap-2 justify-center">
                                    <button data-index="${index}" class="edit-item-btn text-white bg-blue-500 hover:bg-blue-600 py-1 px-3 rounded-lg text-xs">Edit</button>
                                    <button data-index="${index}" class="delete-item-btn text-white bg-red-500 hover:bg-red-600 py-1 px-3 rounded-lg text-xs">Hapus</button>
                                </div>
                            </td>
                        `;
                        editTableBody.appendChild(row);
                    });

                    document.querySelectorAll('.edit-item-btn').forEach(button => {
                        button.addEventListener('click', (e) => {
                            const index = e.target.getAttribute('data-index');
                            editingIndex = index;
                            const transaction = transactions[index];
                            document.getElementById('date').value = transaction.date;
                            document.getElementById('description').value = transaction.description;
                            document.getElementById('income').value = new Intl.NumberFormat('id-ID').format(transaction.income);
                            document.getElementById('expense').value = new Intl.NumberFormat('id-ID').format(transaction.expense);
                            submitButton.textContent = 'Perbarui';

                            // Kembali ke main view
                            editView.classList.add('hidden');
                            mainView.classList.remove('hidden');
                            
                            window.scrollTo({ top: 0, behavior: 'smooth' });
                        });
                    });

                    document.querySelectorAll('.delete-item-btn').forEach(button => {
                        button.addEventListener('click', (e) => {
                            const index = e.target.getAttribute('data-index');
                            transactions.splice(index, 1);
                            saveTransactions();
                            updateBalance();
                            editButton.click(); // Perbarui tampilan edit
                        });
                    });
                }
                
                // Toggle view
                mainView.classList.add('hidden');
                editView.classList.remove('hidden');
            });

            // Tombol kembali (report view)
            backButtonReport.addEventListener('click', () => {
                reportView.classList.add('hidden');
                mainView.classList.remove('hidden');
            });

            // Tombol kembali (edit view)
            backButtonEdit.addEventListener('click', () => {
                editView.classList.add('hidden');
                mainView.classList.remove('hidden');
            });

            // Muat data saat halaman pertama kali dimuat
            loadTransactions();
        });
    </script>
</body>
</html>
